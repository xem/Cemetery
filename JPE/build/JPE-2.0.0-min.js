/*
 * Copyright (c) 2013 http://colorhook.com
 * @author: <a href="colorhook@gmail.com">colorhook</a>
 * @version: 2.0.0
 * @license: Released under the MIT License.
 *
 * Transplant from Flash AS3 APE Engine
 * http://www.cove.org/ape/
 * Copyright (c) 2006, 2007 Alec Cove
 * Released under the MIT License.
 */
(function(c){if(c.define||c.require){return}var b={};function d(g){var f=g.factory;g.exports={};delete g.factory;f(a,g.exports,g);return g.exports}var a=function(f){if(!b[f]){throw"module "+f+" not found"}return b[f].factory?d(b[f]):b[f].exports};var e=function(g,f){if(b[g]){throw"module "+g+" already defined"}b[g]={id:g,factory:f}};e.remove=function(f){delete b[f]};c.require=a;c.define=e})(this);define("JPE/JPE",function(c,e,b){var f=0,d=["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toString","toLocaleString","valueOf"],h=!{valueOf:0}.propertyIsEnumerable("valueOf"),g=Object.prototype.hasOwnProperty,k=Object.prototype.toString,a=function(l){return k.call(l)==="[object Function]"},j=function(n,m){var l=typeof n;return(n&&(l==="object"||(!m&&(l==="function"||a(n)))))||false},i=function(l,m,t,n,p,u){var q,x,w,o,y,r,v;if(!l||!m){return l}if(p){if(p===2){i(l.prototype,m.prototype,t,n,0,u)}w=p===1||p===3?m.prototype:m;v=p===1||p===4?l.prototype:l;if(!w||!v){return l}}else{w=m;v=l}q=t&&!u;if(n){for(o=0,r=n.length;o<r;++o){y=n[o];if(!g.call(w,y)){continue}x=q?false:y in v;if(u&&x&&j(v[y],true)&&j(w[y],true)){i(v[y],w[y],t,null,0,u)}else{if(t||!x){v[y]=w[y]}}}}else{for(y in w){if(!g.call(w,y)){continue}x=q?false:y in v;if(u&&x&&j(v[y],true)&&j(w[y],true)){i(v[y],w[y],t,null,0,u)}else{if(t||!x){v[y]=w[y]}}}if(h){i(v,w,t,d,p,u)}}return l};i(e,{VERSION:"2.0.0",mix:i,guid:function(l){var m=(f++)+"";return l?l+m:m},isFunction:a,isObject:j,isUndefined:function(l){return l===undefined},isBoolean:function(l){return k.call(l)==="[object Boolean]"},isString:function(l){return k.call(l)==="[object String]"},isNumber:function(l){return k.call(l)==="[object Number]"&&isFinite(l)},isArray:function(l){return k.call(l)==="[object Array]"},Array:{indexOf:function(m,p){if(m.indexOf){return m.indexOf(p)}for(var o=0,n=m.length;o<n;o++){if(m[o]===p){return o}}return -1},each:function(m,p){for(var o=0,n=m.length;o<n;o++){p(m[o],o,m)}},remove:function(l,n){var m=this.indexOf(l,n);if(m!=-1){return l.splice(m,1)}}},merge:function(){var n=arguments,q={},p,m=n.length;for(p=0;p<m;p=p+1){i(q,n[p],true)}return q},extend:function(p,o,m,u){if(!o||!p){return p}var l=Object.prototype,t=function(v){function r(){}r.prototype=v;return new r()},q=o.prototype,n=t(q);p.prototype=n;n.constructor=p;p.superclass=q;if(o!=Object&&q.constructor==l.constructor){q.constructor=o}if(m){i(n,m,true)}if(u){i(p,u,true)}p.superclass=o;return p},newClass:function(l,p,o,n){var m=l;if(!m){m=function(){if(p){p.prototype.constructor.apply(this,arguments)}}}if(p){this.extend(m,p,o,n)}else{this.mix(m.prototype,o);this.mix(m,n)}return m}})});define("JPE/AbstractCollection",function(c,a,d){var b=c("JPE/JPE");var f=c("JPE/CollisionDetector");var e=function(){this.isParented=false;this.container=null;this.particles=[];this.constraints=[]};b.mix(e.prototype,{initSelf:function(){var l=this.particles,k=this.constraints,j=l.length,g=k.length,h;for(h=0;h<j;h++){l[h].initSelf()}for(h=0;h<g;h++){k[h].initSelf()}},addParticle:function(g){this.particles.push(g);if(this.isParented){g.initSelf()}},removeParticle:function(h){var g=b.Array.indexOf(this.particles,h);if(g==-1){return}this.particles.splice(g,1);h.cleanup()},addConstraint:function(g){this.constraints.push(g);g.isParented=true;if(this.isParented){g.initSelf()}},removeConstraint:function(h){var g=b.Array.indexOf(this.constraints,h);if(g===-1){return}this.constraints.splice(g,1);h.cleanup()},paint:function(){var m=this.particles,k=this.constraints,j=m.length,g=k.length,l,n,h;for(h=0;h<j;h++){l=m[h];if((!l.getFixed())||l.getAlwaysRepaint()){l.paint()}}for(h=0;h<g;h++){n=k[h];if((!n.getFixed())||n.getAlwaysRepaint()){n.paint()}}},getAll:function(){return this.particles.concat(this.constraints)},cleanup:function(){var l=this.particles,k=this.constraints,j=l.length,g=k.length,h;for(h=0;h<j;h++){l[h].cleanup()}for(h=0;h<g;h++){k[h].cleanup()}},integrate:function(g){var k=this.particles,j=k.length,h=0;for(;h<j;h++){k[h].update(g)}},satisfyConstraints:function(){var j=this.constraints,g=j.length,h=0;for(;h<g;h++){j[h].resolve()}},checkInternalCollisions:function(){var g=this.particles,q=this.constraints,m=g.length,u=q.length,h,t,r,o,n,l;for(o=0;o<m;o++){h=g[o];if(!h.getCollidable()){continue}for(n=o+1;n<m;n++){t=g[n];if(t.getCollidable()){f.test(h,t)}}for(l=0;l<u;l++){r=q[l];if(r.getCollidable()&&!r.isConnectedTo(h)){r.scp.updatePosition();f.test(h,r.scp)}}}},checkCollisionsVsCollection:function(C){var g=this.particles,q=C.particles,A=C.constraints,t=g.length,x=q.length,h=A.length,l,B,y,v,u,r;for(v=0;v<t;v++){l=g[v];if(!l.getCollidable()){continue}for(u=0;u<x;u++){B=q[u];if(B.getCollidable()){f.test(l,B)}}for(r=0;r<h;r++){y=A[r];if(y.getCollidable()&&!y.isConnectedTo(l)){y.scp.updatePosition();f.test(l,y.scp)}}}var o=this.constraints,z=o.length,m,w;for(u=0;u<z;u++){w=o[u];if(!w.getCollidable()){continue}for(m=0;m<x;m++){l=q[m];if(l.getCollidable()&&!w.isConnectedTo(l)){w.scp.updatePosition();f.test(l,w.scp)}}}}},true);d.exports=e});define("JPE/AbstractConstraint",function(d,b,e){var c=d("JPE/JPE");var a=d("JPE/AbstractItem");var g=d("JPE/Signal");var f=function(h){this.stiffness=h;this.setStyle();this._pool={};this.beforeRenderSignal=new g();this.afterRenderSignal=new g()};c.extend(f,a,{resolve:function(){}});e.exports=f});define("JPE/AbstractItem",function(e,c,f){var d=e("JPE/JPE");var g=e("JPE/Signal");var b=e("JPE/Engine");var a=function(){this._visible=true;this._alwaysRepaint=true;this.lineTickness=0;this.lineColor=0;this.lineAlpha=1;this.fillColor=3355443;this.fillAlpha=1;this.solid=true;this._pool={};this.beforeRenderSignal=new g();this.afterRenderSignal=new g()};d.mix(a.prototype,{get:function(h){return this._pool[h]},set:function(h,i){this._pool[h]=i},initSelf:function(){var h=this.initSelfFunction||this.constructor.initSelfFunction;if(d.isFunction(h)){h(this)}else{b.renderer.initSelf(this)}this.paint()},cleanup:function(){var h=this.cleanupFunction||this.constructor.cleanupFunction;if(d.isFunction(h)){h(this)}else{b.renderer.cleanup(this)}},paint:function(){this.render()},render:function(){this.beforeRenderSignal.dispatch(this);var h=this.renderFunction||this.constructor.renderFunction;if(d.isFunction(h)){h(this)}else{b.renderer.render(this)}this.afterRenderSignal.dispatch(this)},getVisible:function(){return this._visible},setVisible:function(h){if(h==this._visible){return}this._visible=h;b.renderer.setVisible(this)},getAlwaysRepaint:function(){return this._alwaysRepaint},setAlwaysRepaint:function(h){this._alwaysRepaint=h},setStyle:function(j,k,h,l,i){j=j||0;k=k||0;h=h||1;l=l||0;i=i||1;this.setLine(j,k,h);this.setFill(l,i)},setLine:function(i,h,j){this.lineThickness=i;this.lineColor=h;this.lineAlpha=j},setFill:function(h,i){this.fillColor=h;this.fillAlpha=i}});f.exports=a});define("JPE/AbstractParticle",function(b,e,a){var c=b("JPE/JPE");var g=b("JPE/Engine");var j=b("JPE/Collision");var k=b("JPE/AbstractItem");var h=b("JPE/Interval");var f=b("JPE/Vector");var i=b("JPE/Signal");var d=function(l,q,p,m,o,n){k.prototype.constructor.apply(this,null);this.interval=new h(0,0);this.curr=new f(l,q);this.prev=new f(l,q);this.samp=new f();this.temp=new f();this.smashable=false;this.maxExitVelocity=0;this.smashSignal=new i();this.forces=new f();this.forceList=[];this.collision=new j(new f(),new f());this.firstCollision=false;this._fixed=p;this._collidable=true;this.setMass(m);this._elasticity=o;this._friction=n;this._center=new f();this._multisample=0;this.setStyle()};c.extend(d,k,{getElasticity:function(){return this._elasticity},setElasticity:function(l){this._elasticity=l},getMultisample:function(){return this._multisample},setMultisample:function(l){return this._multisample=l},getCollidable:function(){return this._collidable},setCollidable:function(l){this._collidable=l},getFixed:function(){return this._fixed},setFixed:function(l){this._fixed=l},getMass:function(){return this._mass},setMass:function(l){if(l<=0){throw new Error("mass may not be set <= 0")}this._mass=l;this._invMass=1/this._mass},getCenter:function(){this._center.setTo(this.getPx(),this.getPy());return this._center},getFriction:function(){return this._friction},setFriction:function(l){if(l<0||l>1){throw new Error("Legal friction must be >= 0 and <=1")}this._friction=l},getPosition:function(){return new f(this.curr.x,this.curr.y)},setPosition:function(l){this.curr.copy(l);this.prev.copy(l)},getPx:function(){return this.curr.x},setPx:function(l){this.curr.x=l;this.prev.x=l},getPy:function(){return this.curr.y},setPy:function(l){this.curr.y=l;this.prev.y=l},getVelocity:function(){return this.curr.minus(this.prev)},setVelocity:function(l){this.prev=this.curr.minus(l)},addForce:function(l){this.forceList.push(l)},accumulateForces:function(){var n;var l=this.forceList.length;for(var m=0;m<l;m++){n=this.forceList[m];this.forces.plusEquals(n.getValue(this._invMass))}var o=g.forces;l=o.length;for(m=0;m<l;m++){n=o[m];this.forces.plusEquals(n.getValue(this._invMass))}},clearForces:function(){this.forceList.length=0;this.forces.setTo(0,0)},update:function(l){if(this.getFixed()){return}this.accumulateForces();this.temp.copy(this.curr);var m=this.getVelocity().plus(this.forces.multEquals(l));this.curr.plusEquals(m.multEquals(g.damping));this.prev.copy(this.temp);this.clearForces()},resetFirstCollision:function(){this.firstCollision=false},getComponents:function(l){var m=this.getVelocity();var n=l.dot(m);this.collision.vn=l.mult(n);this.collision.vt=m.minus(this.collision.vn);return this.collision},resolveCollision:function(l,q,v,u,t,r){if(this.smashable){var m=q.magnitude();if(m>this.maxExitVelocity){this.smashSignal.dispatch("collision")}}if(this.getFixed()||!this.solid||!r.solid){return}this.curr.copy(this.samp);this.curr.plusEquals(l);this.setVelocity(q)},getInvMass:function(){return(this.getFixed())?0:this._invMass}});a.exports=d});define("JPE/CircleParticle",function(c,a,e){var b=c("JPE/JPE");var d=c("JPE/AbstractParticle");var f=function(h,m,g,j,i,l,k){i=i||1;l=l||0.3;k=k||0;this._radius=g;d.prototype.constructor.call(this,h,m,j,i,l,k)};b.extend(f,d,{getRadius:function(){return this._radius},setRadius:function(g){this._radius=g},getProjection:function(g){var h=this.samp.dot(g);this.interval.min=h-this._radius;this.interval.max=h+this._radius;return this.interval},getIntervalX:function(){this.interval.min=this.curr.x-this._radius;this.interval.max=this.curr.x+this._radius;return this.interval},getIntervalY:function(){this.interval.min=this.curr.y-this._radius;this.interval.max=this.curr.y+this._radius;return this.interval}});e.exports=f});define("JPE/Collision",function(b,a,c){c.exports=function(d,e){this.vn=d;this.vt=e}});define("JPE/CollisionDetector",function(e,i,b){var l=Number.POSITIVE_INFINITY;var j=e("JPE/Vector");var g=e("JPE/CollisionResolver");var h=e("JPE/RigidItem");var k=e("JPE/RectangleParticle");var a=e("JPE/CircleParticle");var c=e("JPE/RigidRectangle");var m=e("JPE/RigidCircle");var d=e("JPE/RigidCollisionResolver");var f={cpa:null,cpb:null,hitpoint:[],hp:new j(),collNormal:null,collDepth:null,test:function(o,n){if(o.getFixed()&&n.getFixed()){return}if(o.getMultisample()==0&&n.getMultisample()==0){this.normVsNorm(o,n)}else{if(o.getMultisample()>0&&n.getMultisample()==0){this.sampVsNorm(o,n)}else{if(n.getMultisample()>0&&o.getMultisample()==0){this.sampVsNorm(n,o)}else{if(o.getMultisample()==n.getMultisample()){this.sampVsSamp(o,n)}else{this.normVsNorm(o,n)}}}}},normVsNorm:function(o,n){o.samp.copy(o.curr);n.samp.copy(n.curr);if(this.testTypes(o,n)){g.resolve(this.cpa,this.cpb,this.collNormal,this.collDepth);return true}return false},sampVsNorm:function(r,n){if(this.normVsNorm(r,n)){return}var q=r.getMultisample(),u=1/(q+1),p=u,o;for(o=0;o<=q;o++){r.samp.setTo(r.prev.x+p*(r.curr.x-r.prev.x),r.prev.y+p*(r.curr.y-r.prev.y));if(this.testTypes(r,n)){g.resolve(this.cpa,this.cpb,this.collNormal,this.collDepth);return}p+=u}},sampVsSamp:function(r,n){if(this.normVsNorm(r,n)){return}var q=r.getMultisample(),u=1/(q+1),p=u,o;for(o=0;o<=q;o++){r.samp.setTo(r.prev.x+p*(r.curr.x-r.prev.x),r.prev.y+p*(r.curr.y-r.prev.y));n.samp.setTo(n.prev.x+p*(n.curr.x-n.prev.x),n.prev.y+p*(n.curr.y-n.prev.y));if(this.testTypes(r,n)){g.resolve(this.cpa,this.cpb,this.collNormal,this.collDepth);return}p+=u}},testTypes:function(o,n){if(o instanceof h&&n instanceof h){this.testTypes2(o,n);return false}if((o instanceof k)&&(n instanceof k)){var p=this.testOBBvsOBB(o,n);return p}else{if((o instanceof a)&&(n instanceof a)){return this.testCirclevsCircle(o,n)}else{if((o instanceof k)&&(n instanceof a)){return this.testOBBvsCircle(o,n)}else{if((o instanceof a)&&(n instanceof k)){return this.testOBBvsCircle(n,o)}}}}return false},testTypes2:function(q,p){var n=false;var o=false;this.hitpoint=[];if(q instanceof c&&p instanceof c){n=this.testOBBvsOBB(q,p);if(n){o=this.findHitPointRR(q,p)}}else{if(q instanceof m&&p instanceof m){n=this.testCirclevsCircle(q,p);if(n){o=this.findHitPointCC(q,p)}}else{if(q instanceof c&&p instanceof m){n=this.testOBBvsCircle(q,p);if(n){o=this.findHitPointRC(q,p)}}else{if(q instanceof m&&p instanceof c){n=this.testOBBvsCircle(p,q);if(n){o=this.findHitPointRC(p,q);if(o){this.getHP();d.resolve(p,q,this.hp,this.collNormal,this.collDepth);return false}}}}}}if(o){this.getHP();d.resolve(q,p,this.hp,this.collNormal,this.collDepth);return false}else{return n}},getHP:function(){this.hp=new j();for(var n=0;n<this.hitpoint.length;n++){this.hp.plusEquals(this.hitpoint[n])}if(this.hitpoint.length>1){this.hp.multEquals(1/this.hitpoint.length)}},captures:function(q,n){var p=false;for(var o=0;o<n.length;o++){if(q.captures(n[o])){this.hitpoint.push(n[o]);p=true}}return p},findHitPointRR:function(o,n){var p=false;if(this.captures(o,n.getVertices())){p=true}if(this.captures(n,o.getVertices())){p=true}return p},findHitPointRC:function(o,n){var p=false;if(this.captures(n,o.getVertices())){p=true}if(this.captures(o,n.getVertices(o.getNormals()))){p=true}return p},findHitPointCC:function(o,n){var p=n.samp.minus(o.samp);if(p.magnitude()<=(o.range+n.range)){this.hitpoint.push(p.normalize().multEquals(o.range).plusEquals(o.samp));return true}else{return false}},testOBBvsOBB:function(p,n){this.collDepth=l;for(var v=0;v<2;v++){var u=p.getAxes()[v],w=p.getProjection(u),q=n.getProjection(u),z=this.testIntervals(w,q);if(z==0){return false}var t=n.getAxes()[v],y=this.testIntervals(p.getProjection(t),n.getProjection(t));if(y==0){return false}var r=Math.abs(z),o=Math.abs(y);if(r<Math.abs(this.collDepth)||o<Math.abs(this.collDepth)){var x=r<o;this.collNormal=x?u:t;this.collDepth=x?z:y}}this.cpa=p;this.cpb=n;return true},testOBBvsCircle:function(o,p){this.collDepth=l;var x=new Array(2),t=0,w,q,n;for(;t<2;t++){w=o.getAxes()[t];q=this.testIntervals(o.getProjection(w),p.getProjection(w));if(q==0){return false}if(Math.abs(q)<Math.abs(this.collDepth)){this.collNormal=w;this.collDepth=q}x[t]=q}n=p.getRadius();if(Math.abs(x[0])<n&&Math.abs(x[1])<n){var v=this.closestVertexOnOBB(p.samp,o);this.collNormal=v.minus(p.samp);var u=this.collNormal.magnitude();this.collDepth=n-u;if(this.collDepth>0){this.collNormal.divEquals(u)}else{return false}}this.cpa=o;this.cpb=p;return true},testCirclevsCircle:function(o,n){var q=this.testIntervals(o.getIntervalX(),n.getIntervalX());if(q==0){return false}var p=this.testIntervals(o.getIntervalY(),n.getIntervalY());if(p==0){return false}this.collNormal=o.samp.minus(n.samp);var r=this.collNormal.magnitude();this.collDepth=o.getRadius()+n.getRadius()-r;if(this.collDepth>0){this.collNormal.divEquals(r);this.cpa=o;this.cpb=n;return true}return false},testIntervals:function(q,p){if(q.max<p.min){return 0}if(p.max<q.min){return 0}var o=p.max-q.min,n=p.min-q.max;return(Math.abs(o)<Math.abs(n))?o:n},closestVertexOnOBB:function(u,o){var w=u.minus(o.samp),t=new j(o.samp.x,o.samp.y),n=0;for(;n<2;n++){var v=w.dot(o.getAxes()[n]);if(v>=0){v=o.getExtents()[n]}else{if(v<0){v=-o.getExtents()[n]}}t.plusEquals(o.getAxes()[n].mult(v))}return t}};b.exports=f});define("JPE/CollisionResolver",function(b,a,c){a.resolve=function(p,o,n,j){var q=n.mult(j);var g=p.getElasticity()+o.getElasticity();var k=p.getInvMass()+o.getInvMass();var f=this.clamp(1-(p.getFriction()+o.getFriction()),0,1);var i=p.getComponents(n);var h=o.getComponents(n);var m=(h.vn.mult((g+1)*p.getInvMass()).plus(i.vn.mult(o.getInvMass()-g*p.getInvMass()))).divEquals(k);var l=(i.vn.mult((g+1)*o.getInvMass()).plus(h.vn.mult(p.getInvMass()-g*o.getInvMass()))).divEquals(k);i.vt.multEquals(f);h.vt.multEquals(f);var e=q.mult(p.getInvMass()/k);var d=q.mult(-o.getInvMass()/k);m.plusEquals(i.vt);l.plusEquals(h.vt);p.resolveCollision(e,m,n,j,-1,o);o.resolveCollision(d,l,n,j,1,p)};a.clamp=function(e,f,d){if(e>d){return d}if(e<f){return f}return e}});define("JPE/Composite",function(d,b,e){var c=d("JPE/JPE");var a=d("JPE/Vector");var g=d("JPE/MathUtil");var f=d("JPE/AbstractCollection");var h=function(){f.prototype.constructor.apply(this);this.delta=new a()};c.extend(h,f,{rotateByRadian:function(o,l){var q,n=this.particles,k=n.length;for(var m=0;m<k;m++){q=n[m];var j=q.getCenter().distance(l);var r=this.getRelativeAngle(l,q.getCenter())+o;q.setPx(Math.cos(r)*j+l.x);q.setPy(Math.sin(r)*j+l.y)}},rotateByAngle:function(k,i){var j=k*g.PI_OVER_ONE_EIGHTY;this.rotateByRadian(j,i)},getFixed:function(){for(var k=0,j=this.particles.length;k<j;k++){if(!particles[k].getFixed()){return false}}return true},setFixed:function(j){for(var m=0,k=this.particles.length;m<k;m++){this.particles[m].setFixed(j)}},getRelativeAngle:function(i,j){this.delta.setTo(j.x-i.x,j.y-i.y);return Math.atan2(this.delta.y,this.delta.x)}});e.exports=h});define("JPE/EaselRenderer",function(d,g,b){var e=d("JPE/JPE");var f=d("JPE/Renderer");var h=d("JPE/RectangleParticle");var c=d("JPE/RigidRectangle");var a=d("JPE/CircleParticle");var k=d("JPE/RigidCircle");var j=d("JPE/WheelParticle");var m=d("JPE/SpringConstraintParticle");var i=d("JPE/SpringConstraint");var l=function(n){f.prototype.constructor.apply(this,arguments);this.stage=n;this.registerDelegate("RectangleParticle",h,new l.RectangleParticleDelegate(this));this.registerDelegate("RigidRectangle",c,new l.RectangleParticleDelegate(this));this.registerDelegate("CircleParticle",a,new l.CircleParticleDelegate(this));this.registerDelegate("RigidCircle",k,new l.WheelParticleDelegate(this));this.registerDelegate("WheelParticle",j,new l.WheelParticleDelegate(this));this.registerDelegate("SpringConstraintParticle",m,new l.SpringConstraintParticleDelegate(this));this.registerDelegate("SpringConstraint",i,new l.SpringConstraintDelegate(this))};e.extend(l,f);l.AbstractDelegate=function(n){this.renderer=n;this.stage=n.stage};e.mix(l.AbstractDelegate.prototype,{initSelf:function(p){var o=new Container(),n=new Shape();o.addChild(n);if(!p.getVisible()){o.visible=false}this.stage.addChild(o);p.set("sprite",o);p.set("shape",n);this.drawShape(p)},cleanup:function(o){var n=o.get("sprite");if(n){this.stage.removeChild(n)}},drawShape:function(n){},setVisible:function(o){var n=o.get("sprite");if(n){n.visible=o.getVisible()}},render:function(n){}},true);l.RectangleParticleDelegate=function(){l.AbstractDelegate.apply(this,arguments)};e.extend(l.RectangleParticleDelegate,l.AbstractDelegate,{drawShape:function(r){var o=r.get("shape"),q=o.graphics,n=r.getExtents()[0]*2,p=r.getExtents()[1]*2;o.x=-n/2;o.y=-p/2;q.clear();if(r.lineThickness){q.setStrokeStyle(r.lineThickness);q.beginStroke(Graphics.getRGB(r.lineColor,r.lineAlpha))}q.beginFill(Graphics.getRGB(r.fillColor,r.fillAlpha));q.drawRect(0,0,n,p);q.endFill()},render:function(u){var p=u.get("sprite"),n=u.curr.x,v=u.curr.y,o=u.getExtents()[0]*2,q=u.getExtents()[1]*2,t=u.getAngle();if(p){this.drawShape(u);p.rotation=t;p.x=n;p.y=v}}});l.CircleParticleDelegate=function(){l.AbstractDelegate.apply(this,arguments)};e.extend(l.CircleParticleDelegate,l.AbstractDelegate,{drawShape:function(q){var p=q.getRadius(),n=q.get("shape"),o=n.graphics;o.clear();if(q.lineThickness){o.setStrokeStyle(q.lineThickness);o.beginStroke(Graphics.getRGB(q.lineColor,q.lineAlpha))}o.beginFill(Graphics.getRGB(q.fillColor,q.fillAlpha));o.drawCircle(0,0,p);o.endFill()},render:function(p){var n=p.curr.x,q=p.curr.y,o=p.get("sprite");if(o){this.drawShape(p);o.x=n;o.y=q}}});l.WheelParticleDelegate=function(){l.AbstractDelegate.apply(this,arguments)};e.extend(l.WheelParticleDelegate,l.AbstractDelegate,{drawShape:function(q){var p=q.getRadius(),n=q.get("shape"),o=n.graphics;o.clear();if(q.lineThickness){o.setStrokeStyle(q.lineThickness);o.beginStroke(Graphics.getRGB(q.lineColor,q.lineAlpha))}o.beginFill(Graphics.getRGB(q.fillColor,q.fillAlpha));o.drawCircle(0,0,p);o.setStrokeStyle(1);o.beginStroke(Graphics.getRGB(16777215-q.lineColor));o.moveTo(-p,0);o.lineTo(p,0);o.moveTo(0,-p);o.lineTo(0,p);o.endFill()},render:function(q){var n=q.curr.x,t=q.curr.y,p=q.getAngle(),o=q.get("sprite");if(o){this.drawShape(q);o.rotation=p;o.x=n;o.y=t}}});l.SpringConstraintParticleDelegate=function(){l.AbstractDelegate.apply(this,arguments)};e.extend(l.SpringConstraintParticleDelegate,l.AbstractDelegate,{initSelf:function(q){var o=new Container(),n=new Shape(),p=q.parent,r=p.get("sprite");if(!r){r=new Container();p.set("sprite",r)}q.set("sprite",o);q.set("shape",n);if(!q.getVisible()){sprite.visible=false}o.addChild(n);r.addChild(o);this.drawShape(q);this.stage.addChild(r)},cleanup:function(o){var n=o.parent;this.stage.removeChild(n.get("sprite"))},drawShape:function(t){var o=t.get("shape"),r=o.graphics,q=t.parent,u=q.getCenter(),n=q.getCurrLength()*t.getRectScale(),p=t.getRectHeight();r.clear();if(q.lineThickness){r.setStrokeStyle(q.lineThickness);r.beginStroke(Graphics.getRGB(q.lineColor,q.lineAlpha))}r.beginFill(Graphics.getRGB(q.fillColor,q.fillAlpha));r.drawRect(-n/2,-p/2,n,p);r.endFill()},render:function(q){var p=q.parent,r=p.getCenter(),o=q.get("sprite"),n=q.get("shape");o.x=r.x;o.y=r.y;if(q.scaleToLength){o.width=p.getCurrLength()*q.getRectScale()}o.rotation=p.getAngle()}});l.SpringConstraintDelegate=function(){l.AbstractDelegate.apply(this,arguments)};e.extend(l.SpringConstraintDelegate,l.AbstractDelegate,{initSelf:function(n){},cleanup:function(o){var n=o.get("sprite");if(n){this.stage.removeChild(n)}},initShape:function(p){var o=new Container(),n=new Shape();p.set("sprite",o);p.set("shape",n);o.addChild(n);this.stage.addChild(o)},drawShape:function(p){var n=p.get("shape"),o=n.graphics,r=p.p1,q=p.p2;o.clear();if(p.lineThickness){o.setStrokeStyle(p.lineThickness);o.beginStroke(Graphics.getRGB(p.lineColor,p.lineAlpha))}o.moveTo(r.getPx(),r.getPy());o.lineTo(q.getPx(),q.getPy());o.endFill()},render:function(n){if(n.getCollidable()){n.scp.paint()}else{if(!n.get("shape")){this.initShape(n)}this.drawShape(n)}}});b.exports=l});define("JPE/Engine",function(b,a,c){c.exports={forces:null,masslessForce:null,groups:null,numGroups:0,timeStep:0,renderer:null,damping:1,constraintCycles:0,constraintCollisionCycles:1,init:function(d){if(isNaN(d)){d=0.25}this.timeStep=d*d;this.groups=[];this.forces=[]},addForce:function(d){this.forces.push(d)},removeForce:function(d){JPE.Array.remove(this.forces,d)},removeAllForce:function(){this.forces=[]},addGroup:function(d){this.groups.push(d);d.isParented=true;this.numGroups++;d.initSelf()},removeGroup:function(d){var e=JPE.Array.indexOf(this.groups,d);if(e==-1){return}this.groups.splice(e,1);d.isParented=false;this.numGroups--;d.cleanup()},step:function(){this.integrate();for(var d=0;d<this.constraintCycles;d++){this.satisfyConstraints()}for(var e=0;e<this.constraintCollisionCycles;e++){this.satisfyConstraints();this.checkCollisions()}},paint:function(){for(var d=0;d<this.numGroups;d++){var e=this.groups[d];e.paint()}},integrate:function(){for(var d=0;d<this.numGroups;d++){var e=this.groups[d];e.integrate(this.timeStep)}},satisfyConstraints:function(){for(var d=0;d<this.numGroups;d++){var e=this.groups[d];e.satisfyConstraints()}},checkCollisions:function(){for(var d=0;d<this.numGroups;d++){var e=this.groups[d];e.checkCollisions()}}}});define("JPE/Group",function(d,a,e){var f=d("JPE/AbstractCollection");var c=d("JPE/JPE");var b=function(g){f.prototype.constructor.call(this);this.composites=[];this.collisionList=[];this.collideInternal=g};c.extend(b,f,{initSelf:function(){f.prototype.initSelf.apply(this,arguments);for(var h=0,g=this.composites.length;h<g;h++){this.composites[h].initSelf()}},addComposite:function(g){this.composites.push(g);g.isParented=true;if(this.isParented){g.initSelf()}},removeComposite:function(h){var g=c.Array.indexOf(this.composites,h);if(g===-1){return}this.composites.splice(g,1);h.isParented=false;h.cleanup()},paint:function(){f.prototype.paint.apply(this,arguments);var j=this.composites,h=0,k,g=this.composites.length;for(;h<g;h++){k=j[h];k.paint()}},addCollidable:function(h){this.collisionList.push(h)},removeCollidable:function(h){var i=c.Array.indexOf(this.collisionList,h);if(i==-1){return}this.collisionList.splice(i,1)},addCollidableList:function(k){var j=0,h=k.length,g=this.collisionList;for(;j<h;j++){g.push(k[j])}},getAll:function(){return this.particles.concat(this.constraints).concat(this.composites)},cleanup:function(){f.prototype.cleanup.apply(this,arguments);var j=this.composites,g=j.length,h=0;for(;h<g;h++){j[h].cleanup()}},integrate:function(h){f.prototype.integrate.apply(this,arguments);var k=this.composites,g=k.length,j=0;for(;j<g;j++){k[j].integrate(h)}},satisfyConstraints:function(){f.prototype.satisfyConstraints.apply(this,null);var j=this.composites,g=j.length,h=0;for(;h<g;h++){j[h].satisfyConstraints()}},checkCollisions:function(){if(this.collideInternal){this.checkCollisionGroupInternal()}var g=this.collisionList,j=g.length,h=0;for(;h<j;h++){this.checkCollisionVsGroup(g[h])}},checkCollisionGroupInternal:function(){this.checkInternalCollisions();var m=this.composites,n,l,g=m.length,k=0,h;for(;k<g;k++){n=m[k];n.checkCollisionsVsCollection(this);for(h=k+1;h<g;h++){l=m[h];n.checkCollisionsVsCollection(l)}}},checkCollisionVsGroup:function(o){this.checkCollisionsVsCollection(o);var n=this.composites,q,p,h=n.length,k=o.composites.length,m=0,l;for(;m<h;m++){q=n[m];q.checkCollisionsVsCollection(o);for(l=0;l<k;l++){p=o.composites[l];q.checkCollisionsVsCollection(p)}}for(l=0;l<k;l++){p=o.composites[l];this.checkCollisionsVsCollection(p)}}});e.exports=b});define("JPE/IForce",function(b,a,c){var d=function(){};d.prototype.getValue=function(e){return null};c.exports=d});define("JPE/Interval",function(b,a,c){c.exports=function(e,d){this.min=e;this.max=d}});define("JPE/MathUtil",function(b,a,c){a.ONE_EIGHTY_OVER_PI=180/Math.PI;a.PI_OVER_ONE_EIGHTY=Math.PI/180;a.clamp=function(f,e,d){if(f<e){return e}if(f>d){return d}return f};a.sign=function(d){if(d<0){return -1}return 1}});define("JPE/RectangleParticle",function(d,b,f){var c=d("JPE/JPE");var e=d("JPE/AbstractParticle");var a=d("JPE/Vector");var h=d("JPE/MathUtil");var g=function(n,m,i,o,p,k,l,q,j){p=p||0;l=l||1;q=q||0.3;j=j||0;this._extents=[i/2,o/2];this._axes=[new a(0,0),new a(0,0)];this.setRadian(p);e.prototype.constructor.call(this,n,m,k,l,q,j)};c.extend(g,e,{getRadian:function(){return this._radian},setRadian:function(i){this._radian=i;this.setAxes(i)},getAngle:function(){return this.getRadian()*h.ONE_EIGHTY_OVER_PI},setAngle:function(i){this.setRadian(i*h.PI_OVER_ONE_EIGHTY)},setWidth:function(i){this._extents[0]=i/2},getWidth:function(){return this._extents[0]*2},setHeight:function(i){this._extents[1]=i/2},getHeight:function(){return this._extents[1]*2},getExtents:function(){return this._extents},getProjection:function(j){var l=this.getAxes(),k=this.getExtents(),i=k[0]*Math.abs(j.dot(l[0]))+k[1]*Math.abs(j.dot(l[1]));var m=this.samp.dot(j);this.interval.min=m-i;this.interval.max=m+i;return this.interval},getAxes:function(){return this._axes},setAxes:function(i){var j=Math.sin(i),l=Math.cos(i),k=this.getAxes();k[0].x=l;k[0].y=j;k[1].x=-j;k[1].y=l}});f.exports=g});define("JPE/Renderer",function(c,a,d){var b=c("JPE/JPE");var e=function(){this._items={};this._delegates={}};b.mix(e.prototype,{registerDelegate:function(g,h,f){this._items[g]=h;this._delegates[g]=f},getParticleClass:function(f){return this._items[f]},getDelegateClass:function(f){return this._delegates[f]},findDelegateByParticle:function(g){var f=g.constructor,i=this._items,h=this._delegates;while(f.superclass){for(var j in i){if(i[j]===f){return h[j]}}f=f.superclass}return null},getRenderDelegate:function(g){var f=g.get("renderDelegate");if(f==undefined){f=this.findDelegateByParticle(g);g.set("renderDelegate",f)}return f},initSelf:function(g){var f=this.getRenderDelegate(g);f&&f.initSelf(g)},cleanup:function(g){var f=this.getRenderDelegate(g);f&&f.cleanup(g)},render:function(g){var f=this.getRenderDelegate(g);f&&f.render(g)},setVisible:function(g){var f=this.getRenderDelegate(g);f&&f.setVisible(g)}});d.exports=e});define("JPE/RigidCircle",function(d,a,e){var c=d("JPE/JPE");var b=d("JPE/RigidItem");var f=function(n,l,j,h,k,o,i,m,g){if(k==null){k=-1}if(k==-1){k=Math.PI*j*j}if(o==null){o=0.3}if(i==null){i=0.2}if(m==null){m=0}if(g==null){g=0}this._radius=j;b.prototype.constructor.call(this,n,l,j,h,k,k*j*j/2,o,i,m,g)};c.extend(f,b,{getRadius:function(){return this._radius},getVertices:function(j){var g=[];for(var h=0;h<j.length;h++){g.push(j[h].mult(this._radius).plusEquals(this.samp))}return g},getProjection:function(g){var h=this.samp.dot(g);this.interval.min=h-this._radius;this.interval.max=h+this._radius;return this.interval},getIntervalX:function(){this.interval.min=this.samp.x-this._radius;this.interval.max=this.samp.x+this._radius;return this.interval},getIntervalY:function(){this.interval.min=this.samp.y-this._radius;this.interval.max=this.samp.y+this._radius;return this.interval}});e.exports=f});define("JPE/RigidCollisionResolver",function(b,a,c){c.exports={resolve:function(g,e,h,E,F){var v=E.mult(F);var p=g._elasticity+e._elasticity;var k=g.getInvMass()+e.getInvMass();var D=g.getVelocityOn(h);var o=e.getVelocityOn(h);var m=D.minus(o);var C=E.mult(m.dot(E));var y=m.minus(C).normalize();var w=E.plus(y.mult(-0.1)).normalize();var B=h.minus(g.samp);var z=h.minus(e.samp);var i=B.cross(w);var x=z.cross(w);var A=-m.dot(w)*(1+p/2)/(k+i*i/g.mi+x*x/e.mi);var u=g.getVelocity().plus(w.mult(A*g.getInvMass()));var t=e.getVelocity().plus(w.mult(-A*e.getInvMass()));var r=A*i/g.mi;var q=-A*x/e.mi;if(Math.abs(r)>0.1||Math.abs(q)>0.1){}g.resolveRigidCollision(r,e);e.resolveRigidCollision(q,g);var f=v.mult(g.getInvMass()/k);var d=v.mult(-e.getInvMass()/k);g.resolveCollision(f,u,E,F,-1,e);e.resolveCollision(d,t,E,F,1,g)}}});define("JPE/RigidItem",function(c,g,a){var d=c("JPE/JPE");var e=c("JPE/AbstractParticle");var b=c("JPE/MathUtil");var h=c("JPE/Vector");var i=c("JPE/Engine");var f=function(r,q,m,k,o,n,t,l,p,j){if(o==null){o=1}if(n==null){n=-1}if(t==null){t=0.3}if(l==null){l=0.2}p=p||0;j=j||0;this.range=m;this.frictionalCoefficient=l;this._radian=p;this.angularVelocity=j;this.torque=0;if(k){o=Number.POSITIVE_INFINITY;this.mi=Number.POSITIVE_INFINITY}else{if(n==-1){this.mi=o}else{this.mi=n}}e.prototype.constructor.call(this,r,q,k,o,t,0)};d.extend(f,e,{getRadian:function(){return this._radian},setRadian:function(j){this._radian=j;this.setAxes(j)},getAngle:function(){return this.getRadian()*b.ONE_EIGHTY_OVER_PI},setAngle:function(j){this.setRadian(j*b.PI_OVER_ONE_EIGHTY)},setAxes:function(){},update:function(j){var k=this._radian+this.angularVelocity*i.damping;this.setRadian(k);e.prototype.update.call(this,j);this.torque=0},addTorque:function(j){this.angularVelocity+=j},resolveRigidCollision:function(k,j){if(this.getFixed()||!this.solid||!j.solid){return}this.addTorque(k)},captures:function(j){var k=j.distance(this.samp)-this.range;return k<=0},getVelocityOn:function(m){var k=m.minus(this.samp);var j=k.normalize();var l=this.angularVelocity*k.magnitude();var n=new h(-j.y,j.x).multEquals(l);return n.plusEquals(this.getVelocity())}});a.exports=f});define("JPE/RigidRectangle",function(e,b,f){var d=e("JPE/JPE");var a=e("JPE/Vector");var c=e("JPE/RigidItem");var g=function(q,o,j,r,p,k,n,t,l,h){if(n==null){n=-1}if(n==-1){n=j*r}p=p||0;if(t==null){t=0.3}if(l==null){l=0.2}h=h||0;c.prototype.constructor.call(this,q,o,Math.sqrt(j*j/4+r*r/4),k,n,n*(j*j+r*r)/12,t,l,p,h);this._extents=[j/2,r/2];this._axes=[new a(0,0),new a(0,0)];this._normals=[];this._marginCenters=[];this._vertices=[];for(var m=0;m<4;m++){this._normals.push(new a(0,0));this._marginCenters.push(new a(0,0));this._vertices.push(new a(0,0))}};d.extend(g,c,{getProjection:function(i){var k=this.getAxes(),j=this.getExtents(),h=j[0]*Math.abs(i.dot(k[0]))+j[1]*Math.abs(i.dot(k[1]));var l=this.samp.dot(i);this.interval.min=l-h;this.interval.max=l+h;return this.interval},captures:function(k){var l=this.getMarginCenters();for(var j=0;j<l.length;j++){var h=k.minus(l[j].plus(this.samp)).dot(this.getNormals()[j]);if(h>0.01){return false}}return true},getMarginCenters:function(){return this._marginCenters},getNormals:function(){return this._normals},getExtents:function(){return this._extents},getAxes:function(){return this._axes},setAxes:function(p){var j=Math.sin(p);var o=Math.cos(p);var m=this.getAxes();var k=this.getExtents();var i=this._normals;var l=this._marginCenters;var h=this._vertices;m[0].x=o;m[0].y=j;m[1].x=-j;m[1].y=o;i[0].copy(m[0]);i[1].copy(m[1]);i[2]=m[0].mult(-1);i[3]=m[1].mult(-1);l[0]=m[0].mult(k[0]);l[1]=m[1].mult(k[1]);l[2]=m[0].mult(-k[0]);l[3]=m[1].mult(-k[1]);h[0]=l[0].plus(l[1]);h[1]=l[1].plus(l[2]);h[2]=l[2].plus(l[3]);h[3]=l[3].plus(l[0])},getVertices:function(){var k=[];var j=this._vertices;for(var h=0;h<j.length;h++){k.push(j[h].plus(this.samp))}return k}});f.exports=g});define("JPE/RimParticle",function(e,c,f){var d=e("JPE/JPE");var b=e("JPE/Engine");var a=e("JPE/Vector");var g=function(i,h){this.sp=0;this.av=0;this.wr=i;this.maxTorque=h;this.curr=new a(i,0);this.prev=new a(0,0)};d.mix(g.prototype,{getSpeed:function(){return this.sp},setSpeed:function(h){this.sp=h},getAngularVelocity:function(){return this.av},setAngularVelocity:function(h){this.av=h},update:function(i){this.sp=Math.max(-this.maxTorque,Math.min(this.maxTorque,this.sp+this.av));var q=-this.curr.y;var p=this.curr.x;var k=Math.sqrt(q*q+p*p);q/=k;p/=k;this.curr.x+=this.sp*q;this.curr.y+=this.sp*p;var j=this.prev.x;var h=this.prev.y;var o=this.prev.x=this.curr.x;var m=this.prev.y=this.curr.y;this.curr.x+=b.damping*(o-j);this.curr.y+=b.damping*(m-h);var l=Math.sqrt(this.curr.x*this.curr.x+this.curr.y*this.curr.y);var n=(l-this.wr)/l;this.curr.x-=this.curr.x*n;this.curr.y-=this.curr.y*n}});f.exports=g});define("JPE/Signal",function(c,a,d){var b=c("JPE/JPE");var e=function(){this.__bindings=[];this.__bindingsOnce=[]};b.mix(e.prototype,{add:function(f){return this.registerListener(f)},addOnce:function(f){return this.registerListener(f,true)},remove:function(g){var f=this.find(g),h=this.find(g,this.__bindingsOnce);if(f>=0){this.__bindings.splice(f,1)}if(h>=0){this.__bindingsOnce.splice(h,1)}},removeAll:function(){this.__bindings.length=0;this.__bindingsOnce.length=0},dispatch:function(){var g=Array.prototype.slice.call(arguments),m=this.__bindings,j=m.concat(),k;for(var h=0,f=j.length;h<f;h++){k=j[h];k.apply(null,g);if(this.find(k,this.__bindingsOnce)!=-1){this.remove(k)}}},getNumListeners:function(){return this.__bindings.length},registerListener:function(h,g){var f=this.find(h);if(f==-1||!g){this.__bindings.push(h);if(g){this.__bindingsOnce.push(h)}}},find:function(j,f){f=f||this.__bindings;if(f.indexOf){return f.indexOf(j)}for(var h=0,g=f.length;h<g;h++){if(f[h]===j){return h}}return -1}});d.exports=e});define("JPE/SpringConstraint",function(e,b,f){var d=e("JPE/JPE");var h=e("JPE/AbstractConstraint");var g=e("JPE/MathUtil");var a=e("JPE/SpringConstraintParticle");var c=function(n,m,j,i,k,o,l){j=j||0.5;k=k||1;o=o||1;h.prototype.constructor.call(this,j);this.p1=n;this.p2=m;this.checkParticlesLocation();this._restLength=this.getCurrLength();this.inited=false;this.setCollidable(i,k,o,l)};d.extend(c,h,{getRadian:function(){var i=this.getDelta();return Math.atan2(i.y,i.x)},getAngle:function(){return this.getRadian()*g.ONE_EIGHTY_OVER_PI},getCenter:function(){return(this.p1.curr.plus(this.p2.curr)).divEquals(2)},setRectScale:function(i){if(this.scp==null){return}this.scp.setRectScale(i)},getRectScale:function(){return this.scp.getRectScale()},getCurrLength:function(){return this.p1.curr.distance(this.p2.curr)},getRectHeight:function(){return this.scp.getRectHeight()},setRectHeight:function(i){if(this.scp==null){return}this.scp.setRectHeight(i)},getRestLength:function(){return this._restLength},setRestLength:function(i){if(i<=0){throw new Error("restLength must be greater than 0")}this._restLength=i},getFixedEndLimit:function(){return this.scp.getFixedEndLimit()},setFixedEndLimit:function(i){if(this.scp==null){return}this.scp.setFixedEndLimit(i)},getCollidable:function(){return this._collidable},setCollidable:function(i,j,l,k){this._collidable=i;this.scp=null;if(this._collidable){if(this.scp){this.scp.cleanup()}this.scp=new a(this.p1,this.p2,this,j,l,k);if(this.inited){this.scp.initSelf()}}},isConnectedTo:function(i){return(i==this.p1||i==this.p2)},getFixed:function(){return this.p1.getFixed()&&this.p2.getFixed()},initSelf:function(){if(this.getCollidable()){this.scp.initSelf()}this.inited=true},cleanup:function(){if(this.getCollidable()){this.scp.cleanup()}this.inited=false},getDelta:function(){return this.p1.curr.minus(this.p2.curr)},resolve:function(){var m=this.p1,l=this.p2;if(m.getFixed()&&l.getFixed()){return}var i=this.getCurrLength();var k=(i-this.getRestLength())/(i*(m.getInvMass()+l.getInvMass()));var j=this.getDelta().mult(k*this.stiffness);this.p1.curr.minusEquals(j.mult(m.getInvMass()));this.p2.curr.plusEquals(j.mult(l.getInvMass()))},checkParticlesLocation:function(){if(this.p1.curr.x==this.p2.curr.x&&this.p1.curr.y==this.p2.curr.y){this.p2.curr.x+=0.0001}}});f.exports=c});define("JPE/SpringConstraintParticle",function(d,f,b){var e=d("JPE/JPE");var h=d("JPE/RectangleParticle");var g=d("JPE/Vector");var c=d("JPE/MathUtil");var h=d("JPE/RectangleParticle");var a=d("JPE/CircleParticle");var i=function(n,m,l,j,o,k){this.p1=n;this.p2=m;this.lambda=new g(0,0);this.avgVelocity=new g(0,0);this.parent=l;h.prototype.constructor.call(this,0,0,0,0,0,false);this._rectScale=o;this._rectHeight=j;this.scaleToLength=k;this._fixedEndLimit=0;this.rca=new g();this.rcb=new g()};e.extend(i,h,{setRectScale:function(j){this._rectScale=j},getRectScale:function(){return this._rectScale},setRectHeight:function(j){this._rectHeight=j},getRectHeight:function(){return this._rectHeight},setFixedEndLimit:function(j){this._fixedEndLimit=j},getFixedEndLimit:function(){return this._fixedEndLimit},getMass:function(){return(this.p1.getMass()+this.p2.getMass())/2},getElasticity:function(){return(this.p1.getElasticity()+this.p2.getElasticity())/2},getFriction:function(){return(this.p1.getFriction()+this.p2.getFriction())/2},getVelocity:function(){var j=this.p1.getVelocity();var k=this.p2.getVelocity();this.avgVelocity.setTo(((j.x+k.x)/2),((j.y+k.y)/2));return this.avgVelocity},getInvMass:function(){if(this.p1.getFixed()&&this.p2.getFixed()){return 0}return 1/((this.p1.getMass()+this.p2.getMass())/2)},updatePosition:function(){var j=this.parent.getCenter();this.curr.setTo(j.x,j.y);this.setWidth((this.scaleToLength)?this.parent.getCurrLength()*this._rectScale:this.parent.getRestLength()*this._rectScale);this.setHeight(this.getRectHeight());this.setRadian(this.parent.getRadian())},resolveCollision:function(C,y,m,x,l,k){var B=this.getContactPointParam(k);var r=(1-B);var q=B;var A=this.p1;var z=this.p2;var w=this.getFixedEndLimit();var v=this.lambda;if(A.getFixed()){if(q<=w){return}v.setTo(C.x/q,C.y/q);z.curr.plusEquals(v);z.setVelocity(y)}else{if(z.getFixed()){if(r<=w){return}v.setTo(C.x/r,C.y/r);A.curr.plusEquals(v);A.setVelocity(y)}else{var u=(r*r+q*q);if(u==0){return}v.setTo(C.x/u,C.y/u);A.curr.plusEquals(v.mult(r));z.curr.plusEquals(v.mult(q));if(B==0.5){A.setVelocity(y);z.setVelocity(y)}else{var j=(B<0.5)?A:z;j.setVelocity(y)}}}},closestParamPoint:function(l){var k=this.p2.curr.minus(this.p1.curr);var j=(k.dot(l.minus(this.p1.curr)))/(k.dot(k));return c.clamp(j,0,1)},getContactPointParam:function(n){var l;if(n instanceof a){l=this.closestParamPoint(n.curr)}else{if(n instanceof h){var m;var j=new Array(4);var q=Number.POSITIVE_INFINITY;for(var k=0;k<4;k++){this.setCorners(n,k);var o=this.closestPtSegmentSegment();if(o<q){q=o;m=k;j[k]=s}}l=j[m]}}return l},setCorners:function(j,q){var n=j.curr.x;var l=j.curr.y;var v=j.getAxes();var z=j.getExtents();var p=v[0].x*z[0];var o=v[0].y*z[0];var u=v[1].x*z[1];var t=v[1].y*z[1];var A=p-u;var y=o-t;var x=p+u;var w=o+t;var m=this.rca;var k=this.rcb;if(q==0){m.x=n-x;m.y=l-w;k.x=n+A;k.y=l+y}else{if(q==1){m.x=n+A;m.y=l+y;k.x=n+x;k.y=l+w}else{if(q==2){m.x=n+x;m.y=l+w;k.x=n-A;k.y=l-y}else{if(q==3){m.x=n-A;m.y=l-y;k.x=n-x;k.y=l-w}}}}},closestPtSegmentSegment:function(){var n=this.p1.curr,B=this.p2.curr,m=this.rca,A=this.rcb,l=B.minus(n),j=A.minus(m),k=n.minus(m),C,z=l.dot(l),v=j.dot(j),u=j.dot(k),x=l.dot(k),y=l.dot(j),q=z*v-y*y;if(q!=0){s=c.clamp((y*u-x*v)/q,0,1)}else{s=0.5}C=(y*s+u)/v;if(C<0){C=0;s=c.clamp(-x/z,0,1)}else{if(C>0){C=1;s=c.clamp((y-x)/z,0,1)}}var p=n.plus(l.mult(s));var o=m.plus(j.mult(C));var w=p.minus(o);return w.dot(w)}});b.exports=i});define("JPE/Vector",function(d,b,e){var c=d("JPE/JPE");var a=function(g,f){this.x=g||0;this.y=f||0};c.mix(a.prototype,{setTo:function(g,f){this.x=g||0;this.y=f||0},copy:function(f){this.x=f.x;this.y=f.y},dot:function(f){return this.x*f.x+this.y*f.y},cross:function(f){return this.x*f.y-this.y*f.x},plus:function(f){return new a(this.x+f.x,this.y+f.y)},plusEquals:function(f){this.x+=f.x;this.y+=f.y;return this},minus:function(f){return new a(this.x-f.x,this.y-f.y)},minusEquals:function(f){this.x-=f.x;this.y-=f.y;return this},mult:function(f){return new a(this.x*f,this.y*f)},multEquals:function(f){this.x*=f;this.y*=f;return this},times:function(f){return new a(this.x*f.x,this.y*f.y)},divEquals:function(f){if(f==0){f=0.0001}this.x/=f;this.y/=f;return this},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},distance:function(f){var g=this.minus(f);return g.magnitude()},normalize:function(){var f=this.magnitude();if(f==0){f=0.0001}return this.mult(1/f)},normalizeEquals:function(){var f=this.magnitude();if(f==0){f=0.0001}return this.multEquals(1/f)},toString:function(){return Math.floor(this.x*100)/100+" : "+Math.floor(this.y*100)/100}});e.exports=a});define("JPE/VectorForce",function(e,c,f){var d=e("JPE/JPE");var g=e("JPE/IForce");var b=e("JPE/Vector");var a=function(j,i,h){this.fvx=i;this.fvy=h;this.scaleMass=j;this.value=new b(i,h)};d.extend(a,g,{setVx:function(h){this.fvx=h;this.value.x=h},setVy:function(h){this.fvy=h;this.value.y=h},setUseMass:function(h){this.scaleMass=h},getValue:function(h){if(this.scaleMass){this.value.setTo(this.fvx*h,this.fvy*h)}return this.value}});f.exports=a});define("JPE/WheelParticle",function(e,g,c){var f=e("JPE/JPE");var a=e("JPE/RimParticle");var b=e("JPE/CircleParticle");var d=e("JPE/MathUtil");var h=e("JPE/Vector");var i=function(k,q,j,m,l,o,n,p){p=p||1;l=l||1;o=o||0.3;n=n||0;this.lineThickness=1;b.prototype.constructor.apply(this,arguments);this.tan=new h(0,0);this.normSlip=new h(0,0);this.rp=new a(j,2);this.orientation=new h();this.setTraction(p)};f.extend(i,b,{getSpeed:function(){return this.rp.getSpeed()},setSpeed:function(j){this.rp.setSpeed(j)},getAngularVelocity:function(){return this.rp.getAngularVelocity()},setAngularVelocity:function(j){this.rp.setAngularVelocity(j)},getTraction:function(){return 1-this._traction},setTraction:function(j){this._traction=1-j},update:function(j){b.prototype.update.call(this,j);this.rp.update(j)},getRadian:function(){this.orientation.setTo(this.rp.curr.x,this.rp.curr.y);return Math.atan2(this.orientation.y,this.orientation.x)+Math.PI},getAngle:function(){return this.getRadian()*d.ONE_EIGHTY_OVER_PI},resolveCollision:function(j,k,r,q,m,l){b.prototype.resolveCollision.apply(this,arguments);this.resolve(r.mult(d.sign(q*m)))},resolve:function(q){var m=this.rp,l=this.tan;l.setTo(-m.curr.y,m.curr.x);l=l.normalize();var p=l.mult(m.getSpeed());var k=this.getVelocity().plusEquals(p);var o=k.cross(q);l.multEquals(o);m.prev.copy(m.curr.minus(l));var j=(1-this._traction)*m.getSpeed();this.normSlip.setTo(j*q.y,j*q.x);this.curr.plusEquals(this.normSlip);m.setSpeed(m.getSpeed()*this._traction)}});c.exports=i});