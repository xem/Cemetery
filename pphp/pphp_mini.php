<?php $mtime=microtime();$mtime=explode(" ",$mtime);$mtime=$mtime[1]+$mtime[0];$starttime=$mtime;ob_start();register_shutdown_function('process_buffer');function process_buffer(){pphp(ob_get_clean());}function pphp($code){echo'<!doctype html>';$simple_elements=array('meta','base','link','css','favicon','rss','hr','br','wbr','img','param','source','track','area','input','button','option','command');$dom=array();$code=preg_replace( '#\/\*.*?\*\/#s','',$code );$code=explode("\n",$code);foreach($code as$line){$line=trim($line);if(empty($line)||substr($line,0,2)=='//')continue;if($line{0}=="\\"){echo pphp_new_line($dom),substr($line,1);continue;}if(substr($line,0,2)!='::'){echo pphp_new_line($dom),$line;continue;}$tokens=explode(' ',$line);$element=null;$token_position=0;foreach($tokens as$token){$token_position++;if(substr($token,0,2)=='::'&&$token!='::'&&$element==null){$element=substr($token,2);echo pphp_new_line($dom),'<',$element;if(!in_array($element,$simple_elements)){$dom[]=$element;}}if($element!=null){if(empty($token))continue;if(substr($token,0,2)=='//')break;if(substr($token,0,2)=='::'&&$token_position>1&&!in_array($element,$simple_elements)){echo'>',trim(substr($token,2)),'</',$element;array_pop($dom);break;}if($token{0}=='#'){echo' id="',substr($token,1),'"';}elseif($token{0}=='.'){echo' class="',substr($token,1),'"';}elseif(true){}elseif(true){}}if($token=='::'){$e=array_pop($dom);echo pphp_new_line($dom),'</',$e;}}echo'>';}$mtime=microtime();$mtime=explode(' ',$mtime);$mtime=$mtime[1]+$mtime[0];$endtime=$mtime;$totaltime=($endtime-$GLOBALS['starttime']);echo"\n",'<!-- This page was generated in ',substr($totaltime,0,6),' s. -->';}function pphp_new_line($dom){return"\n".str_repeat("    ",count($dom));}?>